@model Download.Models.ProductDisplayView
@using MarkdownDeep;
@{
    ViewBag.Title = "Display";
    int i = 0;
    //contains the converted ReadMe file
    var file = ViewData["Content"];
    var search = ViewData["search"];
    var pageNum = ViewData["page"];

}

<h2>@Model.ProductName</h2>
<hr />
@*Check to see if there are any versions available for display/download*@
@if (Model.Versions.Count() > 0)
{
    <div class="body-content form-horizontal clearfix">



        @foreach (var version in Model.Versions)
        {
            <dl class="dl-horizontal">
                <dt>
                    @Html.DisplayNameFor(model => version.VersionName)
                </dt>
                <dd>
                    @Html.Encode(version.VersionName)
                </dd>
            </dl>
            break;
        }

        @foreach (var date in Model.Versions)
        {
            <dl class="dl-horizontal">
                <dt>
                    @Html.Encode("Date Uploaded")
                </dt>
                <dd>
                    @Html.DisplayFor(model => date.DateCreated)
                </dd>
            </dl>
            break;
        }
        <div class="text-danger">@ViewBag.Message</div>
        <div class="form-group clearfix">
            @foreach (var version in Model.Versions)
            {

                foreach (var arch in version.Archives)
                {
                    if (arch.Installer != null)
                    {

                        using (Html.BeginForm("Download", "Product", new { id = Model.Id, fileName = arch.Installer, verId = version.VersionId, archId = arch.ArchiveId, searchString = search, page = pageNum }, FormMethod.Post, new { @class = "col-md-3" }))
                        {
                            <b>@arch.Installer</b><br />
                            <input type="submit" value="Download Installer" class="btn btn-primary" />

                        }
                    }
                    if (arch.Exe != null)
                    {

                        using (Html.BeginForm("Download", "Product", new { id = Model.Id, fileName = arch.Exe, verId = version.VersionId, archId = arch.ArchiveId, searchString = search, page = pageNum }, FormMethod.Post, new { @class = "col-md-3" }))
                        {
                            <b>@arch.Exe</b><br />
                            <input type="submit" value="Download Exe" class="btn btn-primary" />
                        }
                    }

                }
                break;
            }
            <br />

        </div>
        @if (Model.Versions[0].ExtraFiles.Count() != 0)
        {
            <hr />
            <h5><b>Extra Files</b></h5>
            <hr />
        }

        @foreach (var version in Model.Versions)
        {
            <div class="form-group clearfix">
                @foreach (var ex in version.ExtraFiles)
                {
                    if (ex != null)
                    {
                        <div class="col-md-3">

                            <b> @Html.DisplayFor(model => ex.FileName) </b><br />
                            <i>@Html.DisplayFor(model => ex.FileDescription)</i><br />
                        </div>
                    }
                }
            </div>
            <div class="form-group">
                @foreach (var ex in version.ExtraFiles)
                {
                    if (ex != null)
                    {

                        using (Html.BeginForm("Download", "Product", new { id = Model.Id, fileName = ex.FileName, fileId = ex.ExtraFileId, verId = version.VersionId, searchString = search, page = pageNum }, FormMethod.Post, new { @class = "col-md-3" }))
                        {

                            <input type="submit" value="Download" class="btn btn-primary" />

                        }
                    }
                }
            </div>

                break;
        }
        <hr />

        <div>
            @*If there is more than just the version being shown up above, display links to the additional versions*@
            @if (Model.Versions.Count() > 1)
            {
                <h4>Archived Versions</h4>
            }
            <div>
                <table>
                    @foreach (var version in Model.Versions)
                    {
                        //Skip the first version becuase it is being displayed
                        if (i == 0)
                        {
                            i++;
                        }
                        else
                        {
                            <tr>
                                <td>
                                    @*table of archived versions for this product*@
                                    @Html.ActionLink(version.VersionName, "Display", new { id = Model.Id, VersionId = version.VersionId, searchString = search, page = pageNum })
                                </td>
                            </tr>
                        }
                    }
                </table>
            </div>
        </div>
        <hr />
        <h3>Read Me</h3>
        <hr />
        <div class="col-md-12" style="background-color: rgba(0, 0, 0, 0.15); border: 2px solid #ffffff;">

            @*Display the Markdown readme that was converted to html*@
            @Html.Raw(file)
        </div>


    </div>
}
@if (User.IsInRole("admin") == true || User.IsInRole("member") == true)
{
    <h3>@ViewBag.Message1</h3>
}
else
{
    @*Display another register teaser if they are not members yet*@
    <h3>@ViewBag.Message2</h3>
}
<br />
<p>
    @Html.ActionLink("Back to List", "Index", new { searchString = search, page = pageNum })
</p>